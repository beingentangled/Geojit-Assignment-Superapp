app_id: com.example.superapp

# Shorebird configuration for modular Flutter SuperApp
# This enables independent over-the-air updates for each module

# Main app configuration
flavors:
  production:
    app_id: com.example.superapp.prod
  staging:
    app_id: com.example.superapp.staging
  development:
    app_id: com.example.superapp.dev

# Module-specific update channels
# Each module can be updated independently
channels:
  # Core app channel
  main:
    description: "Core SuperApp infrastructure updates"
    auto_update: true
    rollback_enabled: true

  # Individual module channels
  home_module:
    description: "Home module updates"
    auto_update: true
    rollback_enabled: true
    target_modules: ["home_module"]

  profile_module:
    description: "Profile module updates"
    auto_update: true
    rollback_enabled: true
    target_modules: ["profile_module"]

  jobs_module:
    description: "Jobs module updates"
    auto_update: true
    rollback_enabled: true
    target_modules: ["jobs_module"]

# Update strategies for modules
update_strategy:
  # Staged rollout configuration
  rollout:
    # Start with 5% of users
    initial_percentage: 5
    # Increase by 25% every 2 hours if no issues
    increment_percentage: 25
    increment_interval: "2h"
    # Full rollout after 8 hours if successful
    max_percentage: 100

  # A/B testing configuration for modules
  ab_testing:
    enabled: true
    # Test new module versions with subset of users
    test_percentage: 20
    control_percentage: 80

  # Automatic rollback triggers
  rollback:
    error_rate_threshold: 0.05  # 5% error rate triggers rollback
    crash_rate_threshold: 0.02  # 2% crash rate triggers rollback
    user_feedback_threshold: 2.0  # Rating below 2.0 triggers rollback

# Module isolation configuration
module_isolation:
  enabled: true
  # Prevent module updates from affecting other modules
  isolated_updates: true
  # Allow fallback to previous module version if update fails
  fallback_enabled: true
  # Cross-module dependency checks
  dependency_validation: true

# Performance monitoring for module updates
monitoring:
  # Track module-specific metrics
  module_metrics: true
  # Monitor performance impact of updates
  performance_tracking: true
  # User engagement tracking per module
  engagement_tracking: true

  # Metrics to track per module
  metrics:
    - startup_time
    - memory_usage
    - crash_rate
    - user_engagement
    - feature_usage

# Native module configuration (for AAR/XCFramework modules)
native_modules:
  enabled: true
  # Track native module updates separately
  independent_versioning: true

  modules:
    camera_native:
      channel: "camera_native"
      platform_specific: true
      android_aar_path: "native_modules/camera_native/android/libs"
      ios_framework_path: "native_modules/camera_native/ios/Frameworks"

    payment_native:
      channel: "payment_native"
      platform_specific: true
      android_aar_path: "native_modules/payment_native/android/libs"
      ios_framework_path: "native_modules/payment_native/ios/Frameworks"

    biometric_native:
      channel: "biometric_native"
      platform_specific: true
      android_aar_path: "native_modules/biometric_native/android/libs"
      ios_framework_path: "native_modules/biometric_native/ios/Frameworks"

# Security configuration for OTA updates
security:
  # Code signing for module updates
  code_signing:
    enabled: true
    # Verify module integrity before applying updates
    verify_signatures: true

  # Encryption for update payloads
  encryption:
    enabled: true
    algorithm: "AES-256-GCM"

  # Update source validation
  source_validation:
    enabled: true
    allowed_sources: ["shorebird-cdn", "custom-cdn"]

# Development workflow integration
development:
  # Hot reload for individual modules during development
  hot_reload_modules: true

  # Preview updates before releasing
  preview_mode: true

  # Integration with CI/CD
  ci_integration:
    enabled: true
    # Automatic module update deployment
    auto_deploy: false  # Manual approval required

    # Module-specific build triggers
    triggers:
      home_module:
        paths: ["modules/home_module/**"]
        branch: "main"

      profile_module:
        paths: ["modules/profile_module/**"]
        branch: "main"

      jobs_module:
        paths: ["modules/jobs_module/**"]
        branch: "main"

# User experience configuration
user_experience:
  # Update notification strategy
  notifications:
    enabled: true
    # Notify users about module updates
    module_updates: true
    # Show update progress
    show_progress: true

  # Update scheduling
  scheduling:
    # Prefer updates during low usage periods
    smart_timing: true
    # Allow users to defer updates
    user_deferrable: true
    # Maximum deferral period
    max_deferral: "7d"

  # Bandwidth considerations
  bandwidth:
    # Only update on WiFi by default
    wifi_only: true
    # Allow cellular updates for critical fixes
    cellular_critical_only: true
    # Compress update payloads
    compression: true

# Analytics and reporting
analytics:
  enabled: true

  # Module-specific analytics
  module_analytics:
    # Track module adoption rates
    adoption_tracking: true
    # Monitor module performance
    performance_metrics: true
    # User feedback per module
    feedback_collection: true

  # Business intelligence
  business_metrics:
    # Feature usage analytics
    feature_usage: true
    # User journey tracking
    user_journey: true
    # Revenue impact per module
    revenue_tracking: true

# Experimental features
experimental:
  # Predictive updates based on usage patterns
  predictive_updates: false

  # Machine learning for optimal update timing
  ml_scheduling: false

  # Advanced A/B testing with ML
  ml_ab_testing: false
